<%- include('../layouts/header')%>
<%- include('../partials/user-header')%>

<div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addAddressModalLabel">Add Address</h5>
 
        </div>
        <div id="flashMessage" class="alert alert-danger" style="display: none;"></div>
        <div class="modal-body">
            <form action="/addAddress" method="post" id="addressForm">
                <div class="mb-3">
                    <label for="fullName" class="form-label">Full Name</label>
                    <input type="text" class="form-control" name="Name"  id="fullName" placeholder="Enter your full name" required>
                  </div>
                  <div class="mb-3">
                    <label for="address" class="form-label">Address</label>
                    <input type="text" class="form-control" name="AddressLane" id="address" placeholder="Enter your address" required>
                  </div>
                  <div class="mb-3">
                    <label for="city" class="form-label">City</label>
                    <input type="text" class="form-control" id="city" name="City" placeholder="Enter your city" required>
                  </div>
                  <div class="mb-3">
                    <label for="pincode" class="form-label">Pincode</label>
                    <input type="text" class="form-control" id="pincode" name="Pincode" placeholder="Enter your pincode" required>
                  </div>
                  <div class="mb-3">
                    <label for="state" class="form-label">State</label>
                    <input type="text" class="form-control" id="state" name="State" placeholder="Enter your state" required>
                  </div>
                  <div class="mb-3">
                    <label for="mobileNumber" class="form-label">Mobile Number</label>
                    <input type="tel" class="form-control" id="mobileNumber" name="Mobile" placeholder="Enter your mobile number"   pattern="^[6-9]\d{9}$"
                    title="Enter a valid 10-digit mobile number starting with 6, 7, 8, or 9" required>
                  </div>
                <button type="submit" class="btn btn-primary" data-bs-dismiss="modal" aria-label="Close" >Submit</button>
              
            </div> 
          </form> 
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
     
      </div>
    </div>
  </div>
  
  <!-- edit address -->
<% user.Address.forEach(function(Address) { %>
  <div class="modal fade" id="editAddressModal<%=Address._id%>" tabindex="-1" aria-labelledby="editAddressModalLabel<%=Address._id%>" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editAddressModalLabel<%=Address._id%>">Edit Address</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>  
        <div class="modal-body">
            <form action="/editAddress/<%=Address._id%>" method="post" id="editAddressForm">
                <div class="mb-3">
                    <label for="fullName" class="form-label">Full Name</label>
                    <input type="text" class="form-control" name="Name" value="<%=Address.Name%>"  id="fullName" placeholder="Enter your full name" required>
                  </div>
                  <div class="mb-3">
                    <label for="address" class="form-label">Address</label>
                    <input type="text" class="form-control" name="AddressLane" value="<%=Address.AddressLane%>" id="address" placeholder="Enter your address" required>
                  </div>
                  <div class="mb-3">
                    <label for="city" class="form-label">City</label>
                    <input type="text" class="form-control" id="city" name="City" value="<%=Address.City%>"  placeholder="Enter your city" required>
                  </div>
                  <div class="mb-3">
                    <label for="pincode" class="form-label">Pincode</label>
                    <input type="text" class="form-control" id="pincode" name="Pincode" value="<%=Address.Pincode%>" placeholder="Enter your pincode" required>
                  </div>
                  <div class="mb-3">
                    <label for="state" class="form-label">State</label>
                    <input type="text" class="form-control" id="state" name="State" value="<%=Address.State%>" placeholder="Enter your state" required>
                  </div>
                  <div class="mb-3">
                    <label for="mobileNumber" class="form-label">Mobile Number</label>
                    <input type="tel" class="form-control" id="mobileNumber" name="Mobile" value="<%=Address.Mobile%>" placeholder="Enter your mobile number" required>
                  </div>
                <button type="submit" class="btn btn-primary"  onclick="return validateForm('editAddressForm')" data-bs-dismiss="modal" aria-label="Close">Submit</button>
              
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
      </div>
    </div>
  </div>
  <%})%>

<div class="container">
  <%if(user.Address.length > 0){%>
    <h1 class="text-center tickerTimes">User Addresses</h1>
    <% user.Address.forEach(function(Address) { %>
    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4" style=" background: linear-gradient(to bottom right, rgb(248, 165, 165), rgb(255, 255, 176));">
                <div class="card-body">
                    <h5 class="card-title"><%=Address.Name%></h5>
                    <p class="card-text"><%=Address.AddressLane%></p>   
                    <p class="card-text"><%=Address.City%></p>    
                    <p class="card-text"><%=Address.Pincode%></p>
                    <p class="card-text"><%=Address.State%></p>
                    <p class="card-text"><%=Address.Mobile%></p>
                    <button  class="btn btn-light" data-bs-toggle="modal" data-bs-target="#editAddressModal<%=Address._id%>">
                        <i class="fas fa-plus-circle"></i> Edit Address
                       </button>
                </div>
            </div>
        </div>
    </div>
    <%})%>
    <%}else{%>
      <h1 class="text-center tickerTimes">User Addresses</h1>
      <div class="row">
          <div class="col-md-12">
              <div class="card text-bg-dark">
                  <div class="card-body icons text-center">
                      <h1>NO ADDRESS TO SHOW</h1>
                  </div>
              </div>
          </div>
      </div>

      <%}%>


    <button  class="btn btn-info" data-bs-toggle="modal" data-bs-target="#addAddressModal">
        <i class="fas fa-plus-circle"></i> Add Address
       </button>
</div>


<script>
  function validateForm(formId) {
    const form = document.getElementById(formId);

// Iterate through form elements and check for empty spaces
for (let i = 0; i < form.elements.length; i++) {
  const element = form.elements[i];

  if (element.type !== 'submit' && element.type !== 'button') {
    // Trim the value to remove leading and trailing spaces
    const value = element.value.trim();

    if (value === '') {
      // Display an error message and prevent form submission
      alert(`${element.name} cannot be empty.`);
      return false;
    }
  }
}

// If all checks pass, allow the form to be submitted
return true;
  }
  </script>

<%- include('../layouts/footer') %>